<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <title>Auto MJK - Controle de Combustível e Manutenção</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f0f2f5; margin: 0; padding: 20px; }
    h1, h2, h3 { color: #333; }
    .tabs { display: flex; margin-bottom: 20px; }
    .tab { padding: 10px 20px; background: #ddd; margin-right: 5px; cursor: pointer; border-radius: 5px 5px 0 0; }
    .tab.active { background: #4f46e5; color: white; font-weight: bold; }
    .content { background: white; padding: 20px; border-radius: 0 5px 5px 5px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    .card { background: #fafafa; padding: 15px; margin-bottom: 15px; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
    .card h3 { margin-top: 0; }
    label { display: block; margin-top: 10px; font-weight: bold; }
    input, select, textarea { width: 100%; padding: 8px; margin-top: 5px; box-sizing: border-box; border-radius: 4px; border: 1px solid #ccc; }
    button { margin-top: 15px; padding: 10px 20px; background: #4f46e5; color: white; border: none; border-radius: 5px; cursor: pointer; }
    button:hover { background: #4338ca; }
    .alert { color: #b91c1c; font-weight: bold; margin-top: 10px; }
    textarea { font-family: monospace; }
    .summary { margin-top: 20px; }
    .summary p { margin: 5px 0; }
  </style>
</head>
<body>

  <h1>Auto MJK - Controle de Veículos</h1>

  <div class="tabs">
    <div class="tab active" data-tab="dashboard">Painel</div>
    <div class="tab" data-tab="abastecimento">Abastecimento</div>
    <div class="tab" data-tab="manutencao">Manutenção</div>
    <div class="tab" data-tab="relatorios">Relatórios</div>
  </div>

  <div id="content" class="content"></div>

<script>
(() => {
  const cars = ["Carro 1", "Carro 2", "Carro 3", "Carro 4"];
  let state = {
    fuels: [],
    services: []
  };
  let currentTab = 'dashboard';

  function $(id) { return document.getElementById(id); }
  function $all(selector) { return [...document.querySelectorAll(selector)]; }

  // Helper para salvar e carregar do localStorage
  function save() {
    localStorage.setItem('autoMJKState', JSON.stringify(state));
  }
  function load() {
    const saved = localStorage.getItem('autoMJKState');
    if(saved) state = JSON.parse(saved);
  }

  function renderTabs() {
    $all('.tab').forEach(tab => {
      tab.classList.toggle('active', tab.dataset.tab === currentTab);
    });
  }

  function calcAvgConsumption(carIndex){
    const fuels = state.fuels.filter(f=>f.carIndex===carIndex).sort((a,b)=>a.km-b.km);
    if(fuels.length < 2) return null;
    let totalKm = 0;
    let totalLiters = 0;
    for(let i=1; i<fuels.length; i++){
      const kmDiff = fuels[i].km - fuels[i-1].km;
      if(kmDiff > 0){
        totalKm += kmDiff;
        totalLiters += fuels[i].liters;
      }
    }
    if(totalLiters === 0) return null;
    return (totalKm / totalLiters).toFixed(2);
  }

  function calcMonthlyFuelCost(carIndex){
    const now = new Date();
    return state.fuels.filter(f=>{
      if(f.carIndex!==carIndex) return false;
      const d = new Date(f.date);
      return d.getMonth() === now.getMonth() && d.getFullYear() === now.getFullYear();
    }).reduce((acc,f)=> acc + (f.total || 0), 0).toFixed(2);
  }

  function calcMonthlyServiceCost(carIndex){
    const now = new Date();
    return state.services.filter(s=>{
      if(s.carIndex!==carIndex) return false;
      const d = new Date(s.date);
      return d.getMonth() === now.getMonth() && d.getFullYear() === now.getFullYear();
    }).reduce((acc,s)=> acc + (s.cost || 0), 0).toFixed(2);
  }

  function renderDashboard() {
    const container = document.createElement('div');
    cars.forEach((car, i) => {
      const card = document.createElement('div');
      card.className = 'card';
      const avgCons = calcAvgConsumption(i);
      const fuelCost = calcMonthlyFuelCost(i);
      const serviceCost = calcMonthlyServiceCost(i);

      card.innerHTML = `
        <h3>${car}</h3>
        <p>Consumo médio: ${avgCons ? avgCons + " km/l" : "--"}</p>
        <p>Gasto com combustível (mês): R$ ${fuelCost}</p>
        <p>Gasto com manutenção (mês): R$ ${serviceCost}</p>
        <p>Total gasto no mês: R$ ${(parseFloat(fuelCost) + parseFloat(serviceCost)).toFixed(2)}</p>
      `;
      container.appendChild(card);
    });
    return container;
  }

  function renderAbastecimento() {
    const container = document.createElement('div');
    container.innerHTML = `<h2>Registrar Abastecimento</h2>`;

    const form = document.createElement('form');
    form.innerHTML = `
      <label>Carro:
        <select id="fuel-car">
          ${cars.map((car,i)=>`<option value="${i}">${car}</option>`).join('')}
        </select>
      </label>
      <label>Data:
        <input type="date" id="fuel-date" value="${new Date().toISOString().slice(0,10)}" required />
      </label>
      <label>Quilometragem atual:</label>
      <input type="number" id="fuel-km" min="0" required />
      <label>Litros abastecidos:</label>
      <input type="number" step="0.01" id="fuel-liters" min="0" required />
      <label>Valor total (R$):</label>
      <input type="number" step="0.01" id="fuel-total" min="0" required />
      <label>Tipo de combustível:</label>
      <input type="text" id="fuel-type" placeholder="Gasolina, Etanol, Diesel..." />
      <button type="submit">Salvar</button>
    `;

    form.onsubmit = (e) => {
      e.preventDefault();
      const newFuel = {
        carIndex: parseInt(form.querySelector('#fuel-car').value),
        date: form.querySelector('#fuel-date').value,
        km: parseFloat(form.querySelector('#fuel-km').value),
        liters: parseFloat(form.querySelector('#fuel-liters').value),
        total: parseFloat(form.querySelector('#fuel-total').value),
        type: form.querySelector('#fuel-type').value.trim()
      };
      state.fuels.push(newFuel);
      save();
      alert('Abastecimento salvo!');
      renderMain();
    };

    container.appendChild(form);
    return container;
  }

  function renderManutencao() {
    const container = document.createElement('div');
    container.innerHTML = `<h2>Registrar Manutenção</h2>`;

    const form = document.createElement('form');
    form.innerHTML = `
      <label>Carro:
        <select id="service-car">
          ${cars.map((car,i)=>`<option value="${i}">${car}</option>`).join('')}
        </select>
      </label>
      <label>Data:
        <input type="date" id="service-date" value="${new Date().toISOString().slice(0,10)}" required />
      </label>
      <label>Tipo de serviço:</label>
      <input type="text" id="service-type" required />
      <label>Quilometragem atual:</label>
      <input type="number" id="service-km" min="0" required />
      <label>Custo (R$):</label>
      <input type="number" step="0.01" id="service-cost" min="0" required />
      <label>Observações:</label>
      <textarea id="service-notes" rows="3"></textarea>
      <button type="submit">Salvar</button>
    `;

    form.onsubmit = (e) => {
      e.preventDefault();
      const newService = {
        carIndex: parseInt(form.querySelector('#service-car').value),
        date: form.querySelector('#service-date').value,
        type: form.querySelector('#service-type').value.trim(),
        km: parseFloat(form.querySelector('#service-km').value),
        cost: parseFloat(form.querySelector('#service-cost').value),
        notes: form.querySelector('#service-notes').value.trim()
      };
      state.services.push(newService);
      save();
      alert('Manutenção salva!');
      renderMain();
    };

    container.appendChild(form);
    return container;
  }

  function renderRelatorios() {
    const container = document.createElement('div');
    container.innerHTML = `<h2>Dados Salvos (JSON)</h2>`;

    const preFuels = document.createElement('textarea');
    preFuels.rows = 10;
    preFuels.style.width = "100%";
    preFuels.readOnly = true;
    preFuels.textContent = JSON.stringify(state.fuels, null, 2);

    const preServices = document.createElement('textarea');
    preServices.rows = 10;
    preServices.style.width = "100%";
    preServices.readOnly = true;
    preServices.textContent = JSON.stringify(state.services, null, 2);

    container.appendChild(document.createElement('h3')).textContent = "Abastecimentos";
    container.appendChild(preFuels);
    container.appendChild(document.createElement('h3')).textContent = "Manutenções";
    container.appendChild(preServices);

    return container;
  }

  function renderMain() {
    const content = document.getElementById('content');
    content.innerHTML = '';
    renderTabs();

    let view;
    switch(currentTab) {
      case 'dashboard': view = renderDashboard(); break;
      case 'abastecimento': view = renderAbastecimento(); break;
      case 'manutencao': view = renderManutencao(); break;
      case 'relatorios': view = renderRelatorios(); break;
    }
    content.appendChild(view);
  }

  // Configura clique das tabs
  $all('.tab').forEach(tab => {
    tab.onclick = () => {
      currentTab = tab.dataset.tab;
      renderMain();
    };
  });

  load();
  renderMain();
})();
</script>

</body>
</html>
